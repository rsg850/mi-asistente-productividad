<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mi Asistente de Productividad</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 300;
    }
    .header p {
      opacity: 0.9;
      font-size: 1.1em;
    }
    .form-container {
      padding: 40px;
    }
    .form-section {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      border-left: 4px solid #667eea;
    }
    .section-title {
      font-size: 1.3em;
      font-weight: 600;
      color: #333;
      margin-bottom: 20px;
    }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e1e5e9;
      border-radius: 10px;
      font-size: 15px;
      transition: border-color 0.3s;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    textarea { min-height: 100px; resize: vertical; }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .submit-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 18px 40px;
      border-radius: 50px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    .message {
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .error-message {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .success-message {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .datetime-group {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
    }
    .calendar-section {
      background: #e3f2fd;
      padding: 20px;
      border-radius: 15px;
      border-left: 4px solid #2196F3;
      margin-top: 20px;
    }
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
    .checkbox-item { display: flex; align-items: center; gap: 5px; }
    .checkbox-item input[type="checkbox"] { width: auto; margin: 0; }
    .checkbox-item label { margin: 0; font-weight: normal; }
    .hidden { display: none; }
    .reminder-custom-fields {
      margin-top: 15px;
      padding: 15px;
      background: #fff;
      border-radius: 10px;
      border: 2px solid #e1e5e9;
    }
    .info-message {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 14px;
    }
    @media (max-width: 768px) {
      .form-row { grid-template-columns: 1fr; }
      .form-container { padding: 20px; }
      .header h1 { font-size: 2em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Mi Asistente de Productividad</h1>
      <p>Gestiona tus tareas de forma eficiente</p>
    </div>
    <div class="form-container">
      <form id="taskForm">
        <!-- Información Básica -->
        <div class="form-section">
          <div class="section-title">Información Básica</div>
          <div class="form-group">
            <label for="titulo">¿Qué necesitas hacer? *</label>
            <input type="text" id="titulo" name="titulo" placeholder="Ej: Revisar informes del trimestre" required maxlength="100">
          </div>
          <div class="form-group">
            <label for="descripcion">Descripción detallada</label>
            <textarea id="descripcion" name="descripcion" placeholder="Añade más detalles sobre la tarea..." maxlength="500"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="estado">Estado actual</label>
              <select id="estado" name="estado">
                <option value="Sin empezar">Sin empezar</option>
                <option value="En progreso">En progreso</option>
                <option value="Listo">Listo</option>
              </select>
            </div>
            <div class="form-group">
              <label for="prioridad">Prioridad</label>
              <select id="prioridad" name="prioridad">
                <option value="Media">Media</option>
                <option value="Alta">Alta</option>
                <option value="Baja">Baja</option>
              </select>
            </div>
          </div>
        </div>
        <!-- Categorización y Proyecto -->
        <div class="form-section">
          <div class="section-title">Categorización y Proyecto</div>
          <div class="form-row">
            <div class="form-group">
              <label for="area">Área</label>
              <select id="area" name="area" onchange="toggleOtherArea()">
                <option value="">Seleccionar área...</option>
                <option value="Profesional">Profesional</option>
                <option value="Académico">Académico</option>
                <option value="Personal">Personal</option>
                <option value="Formación">Formación</option>
                <option value="Evaluación">Evaluación</option>
                <option value="Huerta">Huerta</option>
                <option value="Taller">Taller</option>
                <option value="Bungalow">Bungalow</option>
                <option value="Hogar">Hogar</option>
                <option value="Administrativo">Administrativo</option>
                <option value="other">Otra área...</option>
              </select>
              <input type="text" id="area_other" name="area_other" placeholder="Especifica el área" class="hidden">
            </div>
            <div class="form-group">
              <label for="proyecto_id">Proyecto</label>
              <div class="info-message">La selección de proyectos no está disponible temporalmente</div>
              <select id="proyecto_id" name="proyecto_id" disabled>
                <option value="unavailable">No disponible en estos momentos</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="nivel_esfuerzo">Nivel de esfuerzo</label>
            <select id="nivel_esfuerzo" name="nivel_esfuerzo">
              <option value="">Seleccionar esfuerzo...</option>
              <option value="Pequeño">Pequeño (5-15 min)</option>
              <option value="Medio">Medio (30-60 min)</option>
              <option value="Grande">Grande (2+ horas)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Tipo de tarea</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_personal" name="tipo_tarea" value="Personal">
                <label for="tipo_personal">Personal</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_trabajo" name="tipo_tarea" value="Trabajo">
                <label for="tipo_trabajo">Trabajo</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_social" name="tipo_tarea" value="Social">
                <label for="tipo_social">Social</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_salud" name="tipo_tarea" value="Salud">
                <label for="tipo_salud">Salud</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_habitos" name="tipo_tarea" value="Hábitos">
                <label for="tipo_habitos">Hábitos</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_viaje" name="tipo_tarea" value="Viaje">
                <label for="tipo_viaje">Viaje</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_casa" name="tipo_tarea" value="Casa">
                <label for="tipo_casa">Casa</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_formacion" name="tipo_tarea" value="Formación">
                <label for="tipo_formacion">Formación</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="tipo_estudio" name="tipo_tarea" value="Estudio">
                <label for="tipo_estudio">Estudio</label>
              </div>
            </div>
          </div>
        </div>
        <!-- Fechas y Google Calendar -->
        <div class="form-section">
          <div class="section-title">Fechas y Google Calendar</div>
          <div class="form-group">
            <label for="fecha_limite">Fecha límite (Plazo)</label>
            <div class="datetime-group">
              <input type="date" id="fecha_limite" name="fecha_limite">
              <input type="time" id="hora_limite" name="hora_limite">
            </div>
          </div>
          <div class="calendar-section">
            <div style="display:flex;align-items:center;gap:10px;">
              <input type="checkbox" id="add_to_calendar" name="add_to_calendar" value="true">
              <label for="add_to_calendar" style="font-weight:600;">Añadir evento a Google Calendar</label>
            </div>
            <div id="calendarOptions" style="display:none;margin-top:15px;">
              <label style="font-size:.9em;color:#666;">Recordatorios:</label>
              <div class="checkbox-group" style="margin-top:5px;">
                <div class="checkbox-item">
                  <input type="checkbox" id="recordatorio_2h" name="recordatorio_2h">
                  <label for="recordatorio_2h">2 horas antes</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="recordatorio_custom" name="recordatorio_custom" onchange="toggleCustomReminder()">
                  <label for="recordatorio_custom">Recordatorio personalizado</label>
                </div>
              </div>
              <div id="customReminderFields" class="reminder-custom-fields hidden">
                <label>Fecha y hora del recordatorio:</label>
                <div class="datetime-group" style="margin-top:10px;">
                  <input type="date" id="recordatorio_fecha" name="recordatorio_fecha">
                  <input type="time" id="recordatorio_hora" name="recordatorio_hora">
                </div>
                <small style="color:#666;display:block;margin-top:5px;">
                  El recordatorio debe ser antes de la fecha del evento
                </small>
              </div>
            </div>
          </div>
        </div>
        <button type="submit" class="submit-btn" id="submitBtn">Crear Tarea Completa</button>
      </form>
      <div id="successMessage" class="message success-message"></div>
      <div id="errorMessage" class="message error-message"></div>
    </div>
  </div>

  <script>
    // REEMPLAZA esta URL con la de tu Apps Script desplegado
    const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbyHe-HfVf3liyl4NEmh47HO9IheET_wKLi9tPKgXI5C_RPiCNUbcMSDSlAuTgy4_GRX1A/exec';

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('taskForm').addEventListener('submit', handleFormSubmit);
      document.getElementById('add_to_calendar').addEventListener('change', e => {
        document.getElementById('calendarOptions').style.display = e.target.checked ? 'block' : 'none';
      });
      document.getElementById('fecha_limite').setAttribute('min', new Date().toISOString().split('T')[0]);
    });

    function toggleOtherArea() {
      const sel = document.getElementById('area');
      const other = document.getElementById('area_other');
      if (sel.value==='other') {
        other.classList.remove('hidden'); other.required=true;
      } else {
        other.classList.add('hidden'); other.required=false; other.value='';
      }
    }
    function toggleCustomReminder() {
      const c = document.getElementById('recordatorio_custom').checked;
      document.getElementById('customReminderFields').classList.toggle('hidden', !c);
      if (c) document.getElementById('recordatorio_fecha').setAttribute('min', new Date().toISOString().split('T')[0]);
    }
    function showError(msg) {
      const e = document.getElementById('errorMessage');
      e.textContent = `Error: ${msg}`; e.style.display='block';
      setTimeout(()=>e.style.display='none',5000);
    }
    function showSuccess(res) {
      const s = document.getElementById('successMessage');
      let m = '¡Tarea creada con éxito!';
      if(res.notionUrl) m+=` <a href="${res.notionUrl}" target="_blank">Ver en Notion</a>`;
      if(res.calendarUrl) m+=` | <a href="${res.calendarUrl}" target="_blank">Ver en Calendar</a>`;
      s.innerHTML=m; s.style.display='block';
      setTimeout(()=>s.style.display='none',10000);
    }
    function validateForm() {
      const t = document.getElementById('titulo').value.trim();
      if(!t||t.length<3){ showError('El título debe tener al menos 3 caracteres'); return false; }
      if(document.getElementById('recordatorio_custom').checked) {
        const rf=document.getElementById('recordatorio_fecha').value;
        const rh=document.getElementById('recordatorio_hora').value;
        if(!rf||!rh){ showError('Especifica fecha y hora para el recordatorio personalizado'); return false; }
        const fe=document.getElementById('fecha_limite').value;
        const he=document.getElementById('hora_limite').value||'09:00';
        if(fe){
          const ev=new Date(`${fe}T${he}`), rd=new Date(`${rf}T${rh}`);
          if(rd>=ev){ showError('El recordatorio debe ser antes de la fecha del evento'); return false; }
        }
      }
      return true;
    }
    function prepareFormData(){
      const f=document.getElementById('fecha_limite').value;
      const h=document.getElementById('hora_limite').value;
      return {
        action:'createTask',
        titulo:document.getElementById('titulo').value.trim(),
        descripcion:document.getElementById('descripcion').value.trim(),
        estado:document.getElementById('estado').value,
        prioridad:document.getElementById('prioridad').value,
        area:document.getElementById('area').value,
        area_other:document.getElementById('area_other').value.trim(),
        proyecto_id:document.getElementById('proyecto_id').value,
        nivel_esfuerzo:document.getElementById('nivel_esfuerzo').value,
        fecha_limite: f?`${f} ${h||'09:00'}`: null,
        tipo_tarea:Array.from(document.querySelectorAll('input[name="tipo_tarea"]:checked')).map(cb=>cb.value),
        add_to_calendar:document.getElementById('add_to_calendar').checked,
        recordatorio_2h:document.getElementById('recordatorio_2h').checked,
        recordatorio_custom:document.getElementById('recordatorio_custom').checked,
        recordatorio_fecha:document.getElementById('recordatorio_fecha').value,
        recordatorio_hora:document.getElementById('recordatorio_hora').value
      };
    }
    async function handleFormSubmit(e){
      e.preventDefault();
      if(!validateForm())return;
      const btn=document.getElementById('submitBtn');
      btn.disabled=true; btn.textContent='Creando...';
      try {
        const res=await fetch(WEBHOOK_URL,{ method:'POST', headers:{'Content-Type':'text/plain'}, body:JSON.stringify(prepareFormData()) });
        const j=await res.json();
        if(!j.success) throw new Error(j.error||'Error desconocido');
        showSuccess(j);
        e.target.reset();
      } catch(err){
        showError(err.message);
      } finally {
        btn.disabled=false; btn.textContent='Crear Tarea Completa';
      }
    }
  </script>
</body>
</html>
